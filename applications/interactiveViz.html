<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
	<title>Conflict Urbanism: Colombia</title>

	<!-- Bootstrap -->
	<link href="../css/bootstrap.min.css" rel="stylesheet">

	<!-- Custom styles -->
	<link rel="stylesheet" type="text/css" href="../css/project-specific.css">
	<link rel="stylesheet" type="text/css" href="../css/interactive_visualization.css">

	<!-- Scripts -->
	<script type="text/javascript" src="../js/three.js"></script>
	<script type="text/javascript" src="../js/Detector.js"></script>
	<script type="text/javascript" src="../js/stats.min.js"></script>
	<script type="text/javascript" src="../js/tween.min.js"></script>
	<script type="text/javascript" src="../js/d3.js"></script>
	<script type="text/javascript" src="https://d3js.org/d3-queue.v3.min.js"></script>

	<!-- Google fonts -->
	<link href="https://fonts.googleapis.com/css?family=Roboto:100,300,300i,400,700" rel="stylesheet">

	<!-- Google Analytics Code -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-27897156-6', 'auto');
    ga('send', 'pageview');

  </script>
	
	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
</head>

<body>
	<!-- ******* Navbar ******* -->
  <!-- Fixed navbar -->
  <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">CONFLICT URBANISM: COLOMBIA</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="map.html">MAP</a></li>
          <li><a href="animation.html">ANIMATION</a></li>
          <li class="active"><a href="interactiveViz.html">INTERACTIVE VISUALIZATION</a></li>
					<li><a href="about.html">ABOUT</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </nav>

	<!-- Title Text and Header -->
	<div id="victimTitle">
		<p>A random sample of 200,000 victims of the conflict</p>
	</div>
	<!-- <div id="legends">
		<div id="legend01">
			<p><span id="legend01Text"></span></p>
		</div>
		<div id="legendRect01"></div>
		<div id="legend02">
			<p><span id="legend02Text"></span></p>
		</div>
		<div id="legendRect02"></div>
		<div id="legend03">
			<p><span id="legend03Text"></span></p>
		</div>
		<div id="legendRect03"></div>
		<div id="legend04">
			<p><span id="legend04Text"></span></p>
		</div>
		<div id="legendRect04"></div>
		<div id="legend05">
			<p><span id="legend05Text"></span></p>
		</div>
		<div id="legendRect05"></div>
		<div id="legendGradient" class="hidden"></div>
	</div> -->

	<div id="legends">
		<ul>
			<li id="legend01">
				<div class="legendRect" id="legendRect01"></div>
				<p><span id="legend01Text"></span></p>
			</li>
			<li id="legend02">
				<div id="legendGradient" class="hidden"></div>
				<div class="legendRect" id="legendRect02"></div>
				<p><span id="legend02Text"></span></p>
			</li>
			<li id="legend03">
				<div class="legendRect" id="legendRect03"></div>
				<p><span id="legend03Text"></span></p>
			</li>
			<li id="legend04">
				<div class="legendRect" id="legendRect04"></div>
				<p><span id="legend04Text"></span></p>
			</li>
			<li id="legend05">
				<div class="legendRect" id="legendRect05"></div>
				<p><span id="legend05Text"></span></p>
			</li>
			<!-- <div id="legendGradient" class="hidden"></div> -->
		</ul>
	</div>

	<!-- Divs to sort and color data. D3 listens to these divs and updates GL once they are clicked -->
	<div class="button sort" style="background-color: #000000; display: flex;" id="sortTitle">
		<p id="buttonText">Order by:</p>
	</div>
	<!-- 	<div class="button sort" id="sortKey">
		<p id="buttonText">Key</p>
	</div> -->
	<div class="button sort" id="sortHecho">
		<p id="buttonText">Event</p>
	</div>
	<div class="button sort" id="sortActor">
		<p id="buttonText">Actor</p>
	</div>
	<div class="button sort" id="sortGender">
		<p id="buttonText">Gender</p>
	</div>
	<div class="button sort" id="sortRace">
		<p id="buttonText">Race</p>
	</div>
	<div class="button sort" id="sortEventDate">
		<p id="buttonText">Event Date</p>
	</div>
	<div class="button sort" id="sortReportDate">
		<p id="buttonText">Report Date</p>
	</div>

	<!-- Divs to color -->
	<div class="button color" style="background-color: #000000; display: flex;" id="colorTitle">
		<p id="buttonText">Symbolize by:</p>
	</div>
	<!-- 	<div class="button color" id="colorKey">
		<p id="buttonText">Key</p>
	</div> -->
	<div class="button color" id="colorHecho">
		<p id="buttonText">Event</p>
	</div>
	<div class="button color" id="colorActor">
		<p id="buttonText">Actor</p>
	</div>
	<div class="button color" id="colorGender">
		<p id="buttonText">Gender</p>
	</div>
	<div class="button color" id="colorRace">
		<p id="buttonText">Race</p>
	</div>
	<div class="button color" id="colorEventDate">
		<p id="buttonText">Event Date</p>
	</div>
	<!-- 	<div class="button color" id="colorReportDate">
		<p id="buttonText">Report Date</p>
	</div> -->

	<div class="dropdown" id='dropDownParent'>
      <button class="dropbtn">Select a Municipality</button>
      <div class="dropdown-content" id="myddown-cont">
      </div>
    </div>
    <div id="currentMunicip"></div>

	<div id="tooltip" class="hidden">
		<p><span id="dateText">100</span></p>
		<p><span id="eventText">100</span></p>
		<p><span id="actorText">100</span></p>
		<p><span id="genderText">100</span></p>
		<p><span id="ethnicityText">100</span></p>
	</div>

	<div id="loading">
		<p>Loading...</p>
	</div>

	<script>
	// ########################## JAVASCRIPT + THREE.JS ############################
	// Webgl error message
	if ( ! Detector.webgl ) Detector.addGetWebGLMessage();
	// ############################# GLOBAL VARIABLES ##############################
	var container, stats;
	var fieldGeom, camera, scene, renderer, raycaster, particles, geometry, materials = [], colors = [], parameters, i, h, color, size;
	var clock = new THREE.Clock();
	var viewSize, aspectRatio, myWidth, myHeight;
	var needUpdate = false;
	var duration = currentTime = 3;
	var windowHalfX = window.innerWidth / 2;
	var windowHalfY = window.innerHeight / 2;
	// Setup view settings
	viewSize = 850;
	aspectRatio = window.innerWidth / window.innerHeight;	//SQUASH BUG HERE!!!
	myHeight = viewSize;
	myWidth = parseInt(viewSize*aspectRatio);
	var originalWidth = myWidth;
	var dataPadding = 284;
	// For best viewing on my display, 1:1 ratio
	var rectSize = 1.5; //1.5 //1
	var rectSpacerW = rectSpacerH = 0.5; //1
	var mouse = new THREE.Vector2();
	var threshold = rectSize; //rectSpacerW*2;
	var sphere;
	var raycastOn;
	var buttonColorOn = "#7F7F7F";
	var buttonColorOff = "#333333";
	var myFileDataPaths = ['data/200kInteractiveVizSmall.csv', 'data/TextSelectedMunicipalities.tsv'];
	// Variables to record which munipality data points to highlight, if any
	var boolHighlight = false;
	var highlightId;
	var floatHighlightPerc = -0.75;
	var boolMouseOnDropDown = false;
	var currentColor;
	//Victims dataset
	var datasetVictims = [];
	var selectedMunicipalities;
	//Timeline dataset
	var eventTimeline = [ [0, '1985'], [477, '1986'], [1076, '1987'], [1778, '1988'], [2916, '1989'], [4031, '1990'], [5451, '1991'], [6867, '1992'], [8534, '1993'], [10351, '1994'], [12259, '1995'], [15327, '1996'], [19128, '1997'], [25613, '1998'], [31744, '1999'], [38960, '2000'], [53078, '2001'], [69698, '2002'], [89011, '2003'], [101207, '2004'], [112106, '2005'], [123391, '2006'], [134525, '2007'], [146208, '2008'], [156291, '2009'], [162501, '2010'], [167786, '2011'], [174592, '2012'], [182330, '2013'], [190085, '2014'], [197012, '2015'] ];
	var reportTimeline = [ [0, ''], [11, '1990'], [18, '1993'], [19, '1994'], [20, '1996'], [79, '1997'], [423, '1998'], [1713, '1999'], [2834, '2000'], [10129, '2001'], [20233, '2002'], [32689, '2003'], [39577, '2004'], [46517, '2005'], [54223, '2006'], [62978, '2007'], [73698, '2008'], [91335, '2009'], [105601, '2010'], [115881, '2011'], [126337, '2012'], [144304, '2013'], [166458, '2014'], [188663, '2015'], [199998, '2016'] ];
	if(viewSize == 800) {
		var hardCodeTimelineMin = 78;
		var hardCodeTimelineMax = 942;
	} else if (viewSize == 850){
		var hardCodeTimelineMin = 15;
		var hardCodeTimelineMax = 1427;
	} else{
		var hardCodeTimelineMin = 35;
		var hardCodeTimelineMax = 985;
	}
	var hardCodeDataLen = 200000;
	var timelineTagMod = 5;
	//Create as many timeline date events as there are data
	d3.select("body").selectAll(".timeline#event")
	.data(eventTimeline)
	.enter()
	.append('div')
	.attr('class', 'timeline')
	.attr('id', 'event')
	.style('left', function(d,i){
		var canvasX = getXYCoordinates(d[0], myWidth, myHeight)[0];
		canvasX = map_range(canvasX, getXYCoordinates(0, myWidth, myHeight)[0], getXYCoordinates(hardCodeDataLen, myWidth, myHeight)[0], hardCodeTimelineMin, hardCodeTimelineMax);
		return canvasX+"px";
	})
	.append('p')
	.attr('id', 'timelineText')
	.text(function(d){
		if(parseInt(d[1]) != 1988) {
			if (parseInt(d[1])%timelineTagMod ==0){
				return d[1];
			}
		}
	});
	//Create tick marks
	d3.select("body").selectAll('.timelineTick#event')
	.data(eventTimeline)
	.enter()
	.append('div')
	.attr('class', 'timelineTick')
	.attr('id', 'event')
	.style('left', function(d,i){
		var canvasX = getXYCoordinates(d[0], myWidth, myHeight)[0];
		canvasX = map_range(canvasX, getXYCoordinates(0, myWidth, myHeight)[0], getXYCoordinates(hardCodeDataLen, myWidth, myHeight)[0], hardCodeTimelineMin, hardCodeTimelineMax);
		return canvasX+"px";
	});
	//Create as many timeline reported dates as there are data
	d3.select("body").selectAll(".timeline#report")
	.data(reportTimeline)
	.enter()
	.append('div')
	.attr('class', 'timeline')
	.attr('id', 'report')
	.style('left', function(d,i){
		var canvasX = getXYCoordinates(d[0], myWidth, myHeight)[0];
		canvasX = map_range(canvasX, getXYCoordinates(0, myWidth, myHeight)[0], getXYCoordinates(hardCodeDataLen, myWidth, myHeight)[0], hardCodeTimelineMin, hardCodeTimelineMax);
		return canvasX+"px";
	})
	.append('p')
	.attr('id', 'timelineText')
	.text(function(d){
		if (parseInt(d[1]) != 1998 && parseInt(d[1]) != 1996 && parseInt(d[1]) != 1994) {						//1998 and 1996 overlaps so we hide it
			if (parseInt(d[1])%timelineTagMod ==0){
				return d[1];
			}
		}
	});
	//Create tick marks
	d3.select("body").selectAll('.timelineTick#report')
	.data(reportTimeline)
	.enter()
	.append('div')
	.attr('class', 'timelineTick')
	.attr('id', 'report')
	.style('left', function(d,i){
		var canvasX = getXYCoordinates(d[0], myWidth, myHeight)[0];
		canvasX = map_range(canvasX, getXYCoordinates(0, myWidth, myHeight)[0], getXYCoordinates(hardCodeDataLen, myWidth, myHeight)[0], hardCodeTimelineMin, hardCodeTimelineMax);
		return canvasX+"px";
	});
	//Hide the timelines
	d3.selectAll(".timeline").classed("hidden", true);
	//Hide the timeline tick marks
	d3.selectAll(".timelineTick").classed("hidden", true);
	//Run our script, this function and d3 prevent viz from running before data is fully loaded
	parseMyFile(myFileDataPaths);

	// #############################################################################
	// ###### Parses data and establishes queue to load data before viz is run #####
	// #############################################################################

	function parseMyFile(myFileNames) {
		var q = d3.queue();
		q.defer(function(callback) {
			d3.csv(myFileNames[0], function(res) {
				//By default, csv loads all data as strings, here we parse the data into other data types
				res.forEach(function(d,i) {
					d.key = i;							//we also add a temporary key value
					// d.cod_persona = +d.cod_persona;
					d.param_hecho = +d.param_hecho;
					d.uniqueRank_param_hecho = +d.uniqueRank_param_hecho;
					d.uniqueRank_pert_etnica = +d.uniqueRank_pert_etnica;
					d.uniqueRank_genero_hom = +d.uniqueRank_genero_hom;
					d.uniqueRank_event_date = +d.uniqueRank_event_date;
					d.uniqueRank_actors = +d.uniqueRank_actors;
					d.uniqueRank_report_date = +d.uniqueRank_report_date;
					//Reclassifying race data col
					if (d.pert_etnica == "Negro(a) o Afrocolombiano(a)") {
						d.pert_etnica = "Afrocolombian";
					}
					else if (d.pert_etnica == "Gitano(a) ROM") {
						d.pert_etnica = "Other";
					}
					else if (d.pert_etnica == "Indigena") {
						d.pert_etnica = "Indigenous";
					}
					else if (d.pert_etnica == "Palenquero") {
						d.pert_etnica = "Palenquero"
					}
					else if (d.pert_etnica == "Raizal del Archipielago de San Andres y Providencia") {
						d.pert_etnica = "San Andres Providencia";
					}
					else {
						d.pert_etnica = "None";
					}
					d.thisColor = [0,0,0];
				});
				//Passes data to the queue once we have loaded datat
				callback(null, res);
			});
		});
		q.defer(function(callback) {
	      d3.tsv(myFileNames[1], function(res2) {
	        callback(null, res2);
	      });
	    });
		//Once data has loaded, execute rest of code
		q.awaitAll(restOfCode);
	};

	// #############################################################################
	// ################# AFTER DATA HAS LOADED, RUN THE REST #######################
	// #############################################################################

	function restOfCode(err, results) {
		// Set dataset to the data d3 just loaded in the queue
		datasetVictims = results[0];
		selectedMunicipalities = results[1];
		var dataSetLen = datasetVictims.length;

		//Add our drop down content to the menu
	    var dropDownContent = document.getElementById('myddown-cont');

		//Add the "All Municpality" to our dropdown before we add all the municipalities
		var pTag = document.createElement('p');
	    pTag.setAttribute('myid', 'none');
	    pTag.setAttribute('myname', 'all');
      	pTag.setAttribute('onclick', 'dropDownClick(this.getAttribute("myId"), "all")');
	  	pTag.innerHTML = 'All Municipalities';
      	dropDownContent.append(pTag);

      	//sort the selected municipalities for the dropdown menu
		selectedMunicipalities.sort(function(a,b){return(a.Municipality < b.Municipality ?  -1 : (a.Municipality > b.Municipality ? 1 : 0)); });

	    //add those municiplaities to our dropdown list
	    for (j=0; j< selectedMunicipalities.length; j++)
	    {
	      //add the municipalities to the dropdown
	      pTag = document.createElement('p');
	      pTag.setAttribute('myid', selectedMunicipalities[j].ID);
	      pTag.setAttribute('myname', selectedMunicipalities[j].Municipality);
	      pTag.setAttribute('onclick', 'dropDownClick(this.getAttribute("myId"), this.getAttribute("myname"))');
	      pTag.innerHTML = selectedMunicipalities[j].Municipality;
	      dropDownContent.append(pTag);
	    };

	    //Record if we are over the dropdown menu
	    //MIKE - not working correctly right now. We should also be hiding the tooltip when we're onmouseover, should add this to current onmouseover attribute
	    // if it was wokring
	    // document.getElementById('dropDownParent').setAttribute('onmouseover', 'd3.select("#tooltip").classed("hidden", true);');
	    // document.getElementById('dropDownParent').setAttribute('onmouseout', 'd3.select("#tooltip").classed("hidden", false);');
	    document.getElementById('dropDownParent').setAttribute('onmouseover', 'boolMouseOnDropDown = true;');
	    document.getElementById('dropDownParent').setAttribute('onmouseout', 'boolMouseOnDropDown = false;;');

		//Hide loading text
		d3.select("#loading").classed("hidden", true);

		// Three JS functions to first initialize and then animate the scene
		init();
		animate();

		// #############################################################
		// ################# D3 div Click Events #######################
		// #############################################################

		// ### Sorting events ###

		//D3 to Handle click events on sorting our divs
		//d3 listens for when our divs are clicked and then prompts the animation to reset
		d3.select("#sortKey").on("click", function() {
			// Tell Three JS that we need to update the animation
			resetAnimation();
			// Update the 3vectors for all of the particles loaded
			// Each particle has an associated vector, the intial position being the current position of the particle and
			// the final positoin being the indexed XY coordinate of the particle depending on which sort the user has picked
			// Using a timer that is reset each time one of thee sorts is clicked, the animation moves the particle in a straight line
			// from the initial to the final position by multiplying the vector between the two points by 1/(time left in transition
			// animation). Here, for each particle we simply update the start position to the particles current position, the end
			// position to be the user specified sort XY coordinate, and the direction to be the vector b/w those two points.
			// The particles are moved along these vectors in the animate portion of the code.
			for (i = 0; i < dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				// Make sure the start position is the current 3vector
				var start3Vector = new THREE.Vector3(geometry.vertices[i].x, geometry.vertices[i].y, geometry.vertices[i].z);
				// Find the new desired XY coordinates
				var newXY = getXYCoordinates(thisDataPt.key, myWidth, myHeight);
				var end3Vector = new THREE.Vector3(newXY[0], newXY[1], 0);
				// Compute the vector between these two points
				geometry.vertices[i].startPosition = start3Vector;
				geometry.vertices[i].endPosition = end3Vector;
				geometry.vertices[i].direction = start3Vector.clone().sub(end3Vector);
			}
			updateUiSortKey();
		});
		d3.select("#sortHecho").on("click", function() {
			resetAnimation();
			//Update the 3vectors for all of the particles loaded
			for (i = 0; i < dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				var start3Vector = new THREE.Vector3(geometry.vertices[i].x, geometry.vertices[i].y, geometry.vertices[i].z);
				var newXY = getXYCoordinates(thisDataPt.uniqueRank_param_hecho, myWidth, myHeight);
				var end3Vector = new THREE.Vector3(newXY[0], newXY[1], 0);
				geometry.vertices[i].startPosition = start3Vector;
				geometry.vertices[i].endPosition = end3Vector;
				geometry.vertices[i].direction = start3Vector.clone().sub(end3Vector);
			}
			updateUiSortHecho();
		});
		d3.select("#sortActor").on("click", function() {
			resetAnimation();
			//Update the 3vectors for all of the particles loaded
			for (i = 0; i < dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				var start3Vector = new THREE.Vector3(geometry.vertices[i].x, geometry.vertices[i].y, geometry.vertices[i].z);
				var newXY = getXYCoordinates(thisDataPt.uniqueRank_actors, myWidth, myHeight);
				var end3Vector = new THREE.Vector3(newXY[0], newXY[1], 0);
				geometry.vertices[i].startPosition = start3Vector;
				geometry.vertices[i].endPosition = end3Vector;
				geometry.vertices[i].direction = start3Vector.clone().sub(end3Vector);
			}
			updateUiSortActor();
		});
		d3.select("#sortGender").on("click", function() {
			resetAnimation();
			//Update the 3vectors for all of the particles loaded
			for (i = 0; i < dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				var start3Vector = new THREE.Vector3(geometry.vertices[i].x, geometry.vertices[i].y, geometry.vertices[i].z);
				var newXY = getXYCoordinates(thisDataPt.uniqueRank_genero_hom, myWidth, myHeight);
				var end3Vector = new THREE.Vector3(newXY[0], newXY[1], 0);
				geometry.vertices[i].startPosition = start3Vector;
				geometry.vertices[i].endPosition = end3Vector;
				geometry.vertices[i].direction = start3Vector.clone().sub(end3Vector);
			}
			updateUiSortGender();
		});
		d3.select("#sortRace").on("click", function() {
			resetAnimation();
			//Update the 3vectors for all of the particles loaded
			for (i = 0; i < dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				var start3Vector = new THREE.Vector3(geometry.vertices[i].x, geometry.vertices[i].y, geometry.vertices[i].z);
				var newXY = getXYCoordinates(thisDataPt.uniqueRank_pert_etnica, myWidth, myHeight);
				var end3Vector = new THREE.Vector3(newXY[0], newXY[1], 0);
				geometry.vertices[i].startPosition = start3Vector;
				geometry.vertices[i].endPosition = end3Vector;
				geometry.vertices[i].direction = start3Vector.clone().sub(end3Vector);
			}
			updateUiSortRace();
		});
		d3.select("#sortEventDate").on("click", function() {
			resetAnimation();
			//Update the 3vectors for all of the particles loaded
			for (i = 0; i < dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				var start3Vector = new THREE.Vector3(geometry.vertices[i].x, geometry.vertices[i].y, geometry.vertices[i].z);
				var newXY = getXYCoordinates(thisDataPt.uniqueRank_event_date, myWidth, myHeight);
				var end3Vector = new THREE.Vector3(newXY[0], newXY[1], 0);
				geometry.vertices[i].startPosition = start3Vector;
				geometry.vertices[i].endPosition = end3Vector;
				geometry.vertices[i].direction = start3Vector.clone().sub(end3Vector);
			}
			updateUiSortEventDate();
		});
		d3.select("#sortReportDate").on("click", function() {
			resetAnimation();
			//Update the 3vectors for all of hte particles loaded
			for (i = 0; i < dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				var start3Vector = new THREE.Vector3(geometry.vertices[i].x, geometry.vertices[i].y, geometry.vertices[i].z);
				var newXY = getXYCoordinates(thisDataPt.uniqueRank_report_date, myWidth, myHeight);
				var end3Vector = new THREE.Vector3(newXY[0], newXY[1], 0);
				geometry.vertices[i].startPosition = start3Vector;
				geometry.vertices[i].endPosition = end3Vector;
				geometry.vertices[i].direction = start3Vector.clone().sub(end3Vector);
			}
			updateUiSortReportDate();
		});
		// ### Color Events ###
		d3.select("#colorKey").on("click", function() {
			//Update colors of the particles
			currentColor = 'key';
			for (i = 0; i < dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				geometry.colors[i] = colorKey(thisDataPt);
			}
			updateUiColorKey();
		});
		d3.select("#colorHecho").on("click", function() {
			//Update colors of the particles
			currentColor = 'hecho';
			for (i = 0; i < dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				geometry.colors[i] = colorHecho(thisDataPt);
			}
			updateUiColorHecho();
		});
		d3.select("#colorActor").on("click", function() {
			//Update colors of the particles
			currentColor='actor';
			for (i = 0; i < dataSetLen; i ++){

				var thisDataPt = datasetVictims[i];
				geometry.colors[i] = colorActor(thisDataPt);
			}
			updateUiColorActor();
		});
		d3.select("#colorGender").on("click", function() {
			//Update colors of the particles
			currentColor = 'gender';
			for (i = 0; i < dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				geometry.colors[i] = colorGender(thisDataPt);
			}
			updateUiColorGender();
		});
		d3.select("#colorRace").on("click", function() {
			//Update colors of the particles
			currentColor = 'race';
			for (i = 0; i < dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				geometry.colors[i] = colorRace(thisDataPt);
			}
			updateUiColorRace();
		});
		//Optional color by event date for date color
		d3.select("#colorEventDate").on("click", function() {
			// Update colors of the particles
			currentColor = 'eventDate';
			for (i = 0; i < dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				geometry.colors[i] = colorEventDate(thisDataPt);
			}
			updateUiColorEventDate();

		});
		//Optional color by report date for date color
		d3.select("#colorReportDate").on("click", function() {
			// Update colors of the particles
			currentColor = 'reportDate';
			for (i = 0; i < dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				geometry.colors[i] = colorReportDate(thisDataPt);
			}
			updateUiColorReportDate();
		});
	}

	// #############################################################################
	// ##################### THREE JS INITIALIZATION ###############################
	// #############################################################################

	function init() {
		// Tell Three JS where it will be on the webpage
		container = document.createElement( 'div' );
		document.body.appendChild( container );

		// Try to make camera and padding 0 and move the camera positon to center the grid
		if(viewSize == 800){
			horizPadding = 80;
			vertPadding = 40;
			horizAdjust4center = 10;
		} else {
			horizPadding = 0;
			vertPadding = 0;
			horizAdjust4center = 15;
			vertAdjust4center = -20;
		};
		// Create a Three JS camera and position it to look at our viz
		// camera = new THREE.OrthographicCamera(-aspectRatio * viewSize / 2 -horizPadding, aspectRatio * viewSize / 2 +horizPadding, viewSize/2+vertPadding, viewSize/ -2-vertPadding, -100, 100);
		camera = new THREE.OrthographicCamera(-aspectRatio * viewSize / 2 -horizPadding, aspectRatio * viewSize / 2 +horizPadding, viewSize/2+vertPadding, viewSize/ -2-vertPadding, -100, 100);
		camera.position.x = myWidth/2-horizAdjust4center;
		camera.position.y = myHeight/2-dataPadding/2+vertAdjust4center;
		camera.position.z = 1;
		// Initialize the scene that will hold our geometry
		scene = new THREE.Scene();
		// We must bind the data to geometry - the geometry itself cannot be visualized without being assigned a material
		// (later in code), but it holds valuable data like the position of each data point
		geometry = new THREE.Geometry();
		// For each data point, create a vertex and a color
		// For the intial data load we abritrarily set the data to sort to report date XY positions and
		// we assign the color to be based off of the color key
		for ( i = 0; i < datasetVictims.length; i ++ ) {
			thisDataPt = datasetVictims[i];
			var xyCoord = getXYCoordinates(thisDataPt.key, myWidth, myHeight);
			var vertex = new THREE.Vector3();
			vertex.startPosition = new THREE.Vector3(xyCoord[0], xyCoord[1], 0);
			xyCoord = getXYCoordinates(thisDataPt.uniqueRank_event_date, myWidth, myHeight);
			vertex.endPosition = new THREE.Vector3(xyCoord[0], xyCoord[1], 0);
			vertex.direction = vertex.startPosition.clone().sub(vertex.endPosition);
			vertex.copy(vertex.startPosition);
			geometry.vertices.push( vertex );
			colors[i] = colorHecho(thisDataPt);
		}
		//Set our current color
		currentColor = 'hecho';
		// Assign our desired color to each piece of geometry
		geometry.colors = colors;
		// For each datapoint we asign a point material with a rectangle (pixel) size and our desired color
		material = new THREE.PointsMaterial({
			size: rectSize,
			sizeAttenuation: false,
			vertexColors: THREE.VertexColors,
		});
		// We now bind the geometry to the material to create a point that can be visualized, and then add those points to the scene
		particles = new THREE.Points(geometry, material);
		scene.add(particles);
		// Create a mesh sphere that we place over the datapoint that the users mouse is hovering on
		var sphereGeometry = new THREE.SphereGeometry(1, 32, 32);
		var sphereMaterial = new THREE.MeshBasicMaterial( { color: 0xffffff, shading: THREE.FlatShading } );
		sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
		// bind the geometry to the material and create a mesh
		scene.add(sphere);
		// add this mesh to the scene
		// In order to handle mouseover events we create a raycaster and a threshold
		// from the camera's POV, whenever the mouse comes within our threshold of a given location
		// we will want to get this mouse over position and the associated point's data to display to the suer
		raycaster = new THREE.Raycaster();
		raycaster.params.Points.threshold = threshold;
		// To actually render the scene we execute the following
		renderer = new THREE.WebGLRenderer();
		renderer.setPixelRatio( window.devicePixelRatio );
		renderer.setSize(myWidth, myHeight);
		// renderer.setSize(1439, 799)
		container.appendChild( renderer.domElement );
		// Displays our framerate in the ULH corner
		// Event listeners that listen for when the mouse is moved or when the window is resized
		window.addEventListener( 'resize', onWindowResize, false);
		document.addEventListener( 'mousemove', onDocumentMouseMove, false );
		// document.addEventListener( 'mousedown', onDocumentMouseDown);
		// For user friendliness, we identify how we are sorting and coloring to begin by showing the appropriate legend and color
		updateUiSortEventDate();
		updateUiColorHecho();
	}

	// #############################################################################
	// ######################## THREE JS DOCUMENT EVENTS ###########################
	// #############################################################################

	function onWindowResize( event ) {
		//Variables to update whenever the browser window is resized
		windowHalfX = window.innerWidth / 2;
		windowHalfY = window.innerHeight / 2;
		camera.aspect = window.innerWidth / window.innerHeight;
		aspectRatio = window.innerWidth / window.innerHeight;
		camera.updateProjectionMatrix();
		// myHeight = viewSize;
		myWidth = viewSize*aspectRatio;
		// renderer.setSize( window.innerWidth, window.innerHeight );
	}
	function onDocumentMouseMove( event ) {
		//Update our mouse x and y position whenever the mouse moves
		event.preventDefault();
		mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
		mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
	}
	// function onDocumentMouseDown( event) {
	// 	//If mousedown while the mouse is not on the dropdown menu, reset our highlightbool and id
	// 	if (!boolMouseOnDropDown){
	// 		//if the mouse is not on the dropdown menu...
	// 		if(boolHighlight){
	// 			// if there are values that are currently being hight
	// 			boolHighlight = false;
	// 			highlightId = '';
	// 			//update the colors now that boolHighlight is false to return to base colors
	// 			updateAllDataColors(currentColor);
	// 			//MIKE the reset here is what is causing our color flash, maybe it's ok. We could get a mouseover flag to tell when mouse is over color buttons,
	// 			//we would then not do this updateAllDataCOlors line here if mouseover color button since we are just going to be changing it in a second

	// 			//Update the current municipality text to be blank
	// 			document.getElementById('currentMunicip').innerHTML = "<p></p>" 
	// 		}

	// 		// boolHighlight = false;
	// 		// highlightId = '';
	// 	}
	// }

	// #############################################################################
	// ############################ COLOR FUNCTIONS ###############################
	// #############################################################################

	// Rules to color each parameter given a datapoint
	function colorKey (_thisDataPt) {
		var gradientLength = 255;
		var thisColor = _thisDataPt.key%gradientLength;
		thisColor = "rgb(100, " + thisColor +", 100)";
		if(boolHighlight){
			if ( parseInt(_thisDataPt.dane_ocurrencia) != parseInt(highlightId) ){
				thisColor = shadeRGBColor(thisColor, floatHighlightPerc);
			}
		}
		return new THREE.Color(thisColor);
	}
	function colorHecho (_thisDataPt) {
		//HEX COLORS Processing consistent
		var _color1 = "#FF6600";
		var _color2 = "#00FFD0";
		var _color3 = "#459FFF";
		var _color4 = "#595959";
		//If we are highlighting data points, and if this data point is associated with the chosen municipality, highlight it
		if(boolHighlight){
			if ( parseInt(_thisDataPt.dane_ocurrencia) != parseInt(highlightId) ){
				_color1 = shadeColor2(_color1, floatHighlightPerc);
				_color2 = shadeColor2(_color2, floatHighlightPerc);
				_color3 = shadeColor2(_color3, floatHighlightPerc);
				_color4 = shadeColor2(_color4, floatHighlightPerc);
			}
		}
		_color1 = new THREE.Color(_color1);
		_color2 = new THREE.Color(_color2);
		_color3 = new THREE.Color(_color3);
		_color4 = new THREE.Color(_color4);

		if(_thisDataPt.param_hecho == 5) {
			return _color1;
		}
		else if(_thisDataPt.param_hecho == 6) {
			return _color2;
		}
		else if(_thisDataPt.param_hecho == 12) {
			return _color3;
		}
		else {
			return _color4;
		}
	}
	function colorActor (_thisDataPt) {
		//Hex Colors Processing Consistent
		var _color1 ="#FF2EC0";
		var _color2 ="#C0FF2E";
		var _color3 ="#2EC0FF";
		var _color4 ="#FF9E2E";
		var _color5 ="#595959";
		//If we are highlighting data points, and if this data point is associated with the chosen municipality, highlight it
		if(boolHighlight){
			if ( parseInt(_thisDataPt.dane_ocurrencia) != parseInt(highlightId) ){
				_color1 = shadeColor2(_color1, floatHighlightPerc);
				_color2 = shadeColor2(_color2, floatHighlightPerc);
				_color3 = shadeColor2(_color3, floatHighlightPerc);
				_color4 = shadeColor2(_color4, floatHighlightPerc);
				_color5 = shadeColor2(_color5, floatHighlightPerc);
			}
		}
		_color1 = new THREE.Color(_color1);
		_color2 = new THREE.Color(_color2);
		_color3 = new THREE.Color(_color3);
		_color4 = new THREE.Color(_color4);
		_color5 = new THREE.Color(_color5);

		if (_thisDataPt.autor_guerrillas == 1) {
			return _color1;
		}
		else if(_thisDataPt.autor_paramilitares == 1) {
			return _color2;
		}
		else if(_thisDataPt.autor_fuerza_publica == 1) {
			return _color3;
		}
		else if(_thisDataPt.autor_bacrim ==1) {
			return _color4;
		}
		else {
			return _color5;
		}
	}
	function colorGender (_thisDataPt) {
		//Hex Colors Processing Consistent
		var _color1 ='#40FF9F';
		var _color2 ='#FFBC40';
		var _color4 ='#BC40FF';
		//If we are highlighting data points, and if this data point is associated with the chosen municipality, highlight it
		if(boolHighlight){
			if ( parseInt(_thisDataPt.dane_ocurrencia) != parseInt(highlightId) ){
				_color1 = shadeColor2(_color1, floatHighlightPerc);
				_color2 = shadeColor2(_color2, floatHighlightPerc);
				_color4 = shadeColor2(_color4, floatHighlightPerc);
			}
		}
		_color1 = new THREE.Color(_color1);
		_color2 = new THREE.Color(_color2);
		_color4 = new THREE.Color(_color4);

		if(_thisDataPt.genero_hom == "Hombre") {
			return _color1;
		}
		else if(_thisDataPt.genero_hom == "Mujer") {
			return _color2;
		}
		else {
			return _color4;
		}
	}
	function colorRace (_thisDataPt) {
		//Hex Colors Processing Consistent
		var _color1 = "#40FF9F";
		var _color2 = "#FFBC40";
		var _color3 = "#BC40FF";
		var _color4 = "#595959";
		//If we are highlighting data points, and if this data point is associated with the chosen municipality, highlight it
		if(boolHighlight){
			if ( parseInt(_thisDataPt.dane_ocurrencia) != parseInt(highlightId) ){
				_color1 = shadeColor2(_color1, floatHighlightPerc);
				_color2 = shadeColor2(_color2, floatHighlightPerc);
				_color3 = shadeColor2(_color3, floatHighlightPerc);
				_color4 = shadeColor2(_color4, floatHighlightPerc);
			}
		}
		_color1 = new THREE.Color(_color1);
		_color2 = new THREE.Color(_color2);
		_color3 = new THREE.Color(_color3);
		_color4 = new THREE.Color(_color4);

		if(_thisDataPt.pert_etnica == "None") {
			return _color1;
		}
		else if(_thisDataPt.pert_etnica == "Afrocolombian") {
			return _color2;
		}
		else if(_thisDataPt.pert_etnica == "Indigenous") {
			return _color3;
		}
		else {
			return _color4;
		}
	}
	function colorEventDate (_thisDataPt) {
		var gradientLength = datasetVictims.length;;
		var thisColor = parseInt(map_range(_thisDataPt.uniqueRank_event_date, 0, datasetVictims.length, 0, 255));
		thisColor = "rgb(100, " + thisColor +", 100)";
		if(boolHighlight){
			if ( parseInt(_thisDataPt.dane_ocurrencia) != parseInt(highlightId) ){
				thisColor = shadeRGBColor(thisColor, floatHighlightPerc);
			}
		}
		return new THREE.Color(thisColor);
	}
	function colorReportDate (_thisDataPt) {
		var gradientLength = datasetVictims.length;;
		var thisColor = parseInt(map_range(_thisDataPt.uniqueRank_report_date, 0, datasetVictims.length, 0, 255));
		thisColor = "rgb(100, " + thisColor +", 100)";
		if(boolHighlight){
			if ( parseInt(_thisDataPt.dane_ocurrencia) != parseInt(highlightId) ){
				thisColor = shadeRGBColor(thisColor, floatHighlightPerc);
			}
		}
		return new THREE.Color(thisColor);
	}
	function shadeColor2(color, percent) {   
		//Code from stack overflow ... questions/5560248/programmatically-lighten-or-darken-a-hex-color-or-rgb-and-blend-colors
	    var f=parseInt(color.slice(1),16),t=percent<0?0:255,p=percent<0?percent*-1:percent,R=f>>16,G=f>>8&0x00FF,B=f&0x0000FF;
	    return "#"+(0x1000000+(Math.round((t-R)*p)+R)*0x10000+(Math.round((t-G)*p)+G)*0x100+(Math.round((t-B)*p)+B)).toString(16).slice(1);
	}
	function shadeRGBColor(color, percent) {
		//Code from stack overflow ... questions/5560248/programmatically-lighten-or-darken-a-hex-color-or-rgb-and-blend-colors
	    var f=color.split(","),t=percent<0?0:255,p=percent<0?percent*-1:percent,R=parseInt(f[0].slice(4)),G=parseInt(f[1]),B=parseInt(f[2]);
	    return "rgb("+(Math.round((t-R)*p)+R)+","+(Math.round((t-G)*p)+G)+","+(Math.round((t-B)*p)+B)+")";
	}
	function getTooltipText (_thisDataPt) {
		//Parse Text For ToolTip Mousover
		var textList = ["Event Date: ", "Type of Event: ", "Actor: ", "Gender: ", "Ethnicity: "];
		var monthList = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
		var dateArray = _thisDataPt.f_ocurrencia_hecho.slice(0, -5).split("/");
		if (dateArray[2] > 20){
			var thisYear = '19' + dateArray[2];
		}
		else {
			var thisYear = '20' + dateArray[2];
		}
		// textList[0] = textList[0] + _thisDataPt.f_ocurrencia_hecho.slice(0, -5);
		textList[0] = textList[0] + monthList[dateArray[0]-1] + ' ' + dateArray[1] + ', ' + thisYear;
		//Parse event data into text
		if(_thisDataPt.param_hecho == 5) {
			var _eventText = "Displacement";
		}
		else if(_thisDataPt.param_hecho == 6) {
			var _eventText = "Homicide";
		}
		else if(_thisDataPt.param_hecho == 12) {
			var _eventText = "Threat";
		}
		else {
			var _eventText = "Other";
		}
		textList[1] = textList[1] + _eventText;
		// Parse actor data  into text
		if (_thisDataPt.autor_guerrillas == 1) {
			var _actorText = "Guerrillas";
		}
		else if(_thisDataPt.autor_paramilitares == 1) {
			var _actorText = "Paramilitaries";
		}
		else if(_thisDataPt.autor_fuerza_publica == 1) {
			var _actorText = "Armed Forces";
		}
		else if(_thisDataPt.autor_bacrim ==1) {
			var _actorText = "BACRIM";
		}
		else if(_thisDataPt.autor_no_identifica == 33){
			var _actorText = "Multiple Actors";
		}
		else {
			var _actorText = "Other or Non-Identified";
		}
		textList[2] = textList[2] + _actorText;
		// textList[3] = textList[3] + _thisDataPt.genero_hom;
		if (_thisDataPt.genero_hom == "Hombre"){
			textList[3] = textList[3] + "Male";
		} else if (_thisDataPt.genero_hom == "Mujer"){
			textList[3] = textList[3] + "Female";
		} else {
			textList[3] = textList[3] + "Other or N/A";
		}
		textList[4] = textList[4] + _thisDataPt.pert_etnica;
		return textList;
	}

	// #############################################################################
	// ##################### THREE JS ANIMATION  AND RENDER ########################
	// #############################################################################

	function resetAnimation() {
		//Function that we call to reset the animation
		// turn off the raycaster while the viz is transitioning to reduce burden on browser
		raycastOn = false;

		// Reset our countdown timer - this timer is what enables the particles to slide along their
		// initial position to their final position
		currentTime = duration;
	}
	//Time delta to track time passed
	var delta;
	function animate() {
		//Function attempts to run 60 FPS to run our Viz smoothly
		delta = clock.getDelta();
		currentTime -= delta;
		if(currentTime < 0) {
			// currentTime is less than 0 so any user defined sort has finished
			// reset our currenTime to 0 since it is already negative
			currentTime = 0;
			// Since the particles are not moving we want to calculate raytracing and mouseover
			raycastOn = true;
		}
		// Three JS request the animation frame
		requestAnimationFrame( animate );
		// Moves the particles from their initial positin to their final position
		// Note that once the particles arrive in the user defined sort positoins, after a sort is complete
		// (inital position) = (final position) and the length of the vector is 0 so the particles do not move
		geometry.vertices.forEach(function(vertex){
			vertex.addVectors(vertex.endPosition,vertex.direction.clone().multiplyScalar(currentTime / duration));
		});
		// Tells Three JS that we should update the geometries verticies (position on screen) and their color
		// for every frame we display
		geometry.verticesNeedUpdate = true;
		geometry.colorsNeedUpdate = true;
		// Tell Three JS to render the scene and update our stats
		render();
	}
	function render() {
		//Find where the event is in world coordinates
		worldX = parseInt(map_range(mouse.x, -1, 1, 0, windowHalfX*2));
		worldY = parseInt(map_range(mouse.y, -1, 1, windowHalfY*2, 0));
		//Calculate raycaster intersections (mouseover events) when we are not actively moving particles on screen
		if(!boolMouseOnDropDown){
			if (raycastOn) {
				// Tell three JS where we are drawing our ray from and based on what point

				// var raycastMouseX = map_range(worldX, 0, 1427, -0.9825, 0.7775000000000001);
				var raycastMouseX = map_range(worldX, 0 ,originalWidth, -1, 1);
				var raycastMouseY = map_range(worldY, 0, myHeight, 1, -1);
				var raycastMouse = new THREE.Vector2(raycastMouseX, raycastMouseY);

				raycaster.setFromCamera( raycastMouse, camera );
				// Calculate what paricles if any the raycaster intersects
				var intersections = raycaster.intersectObject(particles);
				intersection = (intersections.length) > 0 ? intersections[0] : null;
				if(intersection != null) {
					// In the event that we DO intersect a particle, intersection is not null and we proceed
					// Find intersection point so we know where to display our div
					var intersectPosition = intersection.point;
					var divXLoc = worldX;
					if (divXLoc > windowHalfX) {
						divXLoc = divXLoc - 250;
					} else {
						divXLoc = divXLoc + 50;
					}
					var divYLoc = worldY;
					if (divYLoc > windowHalfY) {
						divYLoc = divYLoc - 100;
					}
					//Move our sphere to the intersected poisition
					sphere.position.copy(intersectPosition);
					sphere.visible = true;
					sphere.scale.set(2, 2, 2);
					//Get this data points parameters as text to display in the tool tip
					tooltipTextList = getTooltipText(datasetVictims[intersection.index])
					// Tell d3 where to display our tooltip
					d3.select("#tooltip")
					.transition()
					.duration(100)
					.style("left", divXLoc + "px")
					.style("top", divYLoc + "px");
					d3.select("#dateText")
					.text(tooltipTextList[0]);
					d3.select("#tooltip")
					.select("#eventText")
					.text(tooltipTextList[1]);
					d3.select("#tooltip")
					.select("#actorText")
					.text(tooltipTextList[2]);
					d3.select("#tooltip")
					.select("#genderText")
					.text(tooltipTextList[3]);
					d3.select("#tooltip")
					.select("#ethnicityText")
					.text(tooltipTextList[4]);
					//Show the tooltip
					d3.select("#tooltip").classed("hidden", false);
				} else {
					//Hide our sphere cursor
					sphere.visible = false;
					//Hide the tooltip
					d3.select("#tooltip").classed("hidden", true);
				}
			} else {
				//Hide the tooltip
				d3.select("#tooltip").classed("hidden", true);
			}
		}
		// Three JS render this scene with this camera
		renderer.render( scene, camera );
	}
	//Update UI Elements
	function updateUiSortKey() {
		// Update a/o buttons
		d3.select("#sortHecho")
		.style("background-color", buttonColorOff);
		d3.select("#sortActor")
		.style("background-color", buttonColorOff);
		d3.select("#sortGender")
		.style("background-color", buttonColorOff);
		d3.select("#sortRace")
		.style("background-color", buttonColorOff);
		d3.select("#sortEventDate")
		.style("background-color", buttonColorOff);
		d3.select("#sortReportDate")
		.style("background-color", buttonColorOff);
		//Update this button
		d3.select("#sortKey")
		.style("background-color", buttonColorOn);
		//Hide the timelines if any show
		d3.selectAll(".timeline").classed("hidden", true);
		//Hide the ticks if any show
		d3.selectAll(".timelineTick").classed("hidden", true);
	}
	function updateUiSortHecho() {
		// Update a/o buttons
		d3.select("#sortKey")
		.style("background-color", buttonColorOff);
		d3.select("#sortActor")
		.style("background-color", buttonColorOff);
		d3.select("#sortGender")
		.style("background-color", buttonColorOff);
		d3.select("#sortRace")
		.style("background-color", buttonColorOff);
		d3.select("#sortEventDate")
		.style("background-color", buttonColorOff);
		d3.select("#sortReportDate")
		.style("background-color", buttonColorOff);
		//Update this button
		d3.select("#sortHecho")
		.style("background-color", buttonColorOn);
		//Hide the timelines if any show
		d3.selectAll(".timeline").classed("hidden", true);
		//Hide the ticks if any show
		d3.selectAll(".timelineTick").classed("hidden", true);
	}
	function updateUiSortActor() {
		// Update a/o buttons
		d3.select("#sortKey")
		.style("background-color", buttonColorOff);
		d3.select("#sortHecho")
		.style("background-color", buttonColorOff);
		d3.select("#sortGender")
		.style("background-color", buttonColorOff);
		d3.select("#sortRace")
		.style("background-color", buttonColorOff);
		d3.select("#sortEventDate")
		.style("background-color", buttonColorOff);
		d3.select("#sortReportDate")
		.style("background-color", buttonColorOff);
		//Update this button
		d3.select("#sortActor")
		.style("background-color", buttonColorOn);
		//Hide the timelines if any show
		d3.selectAll(".timeline").classed("hidden", true);
		//Hide the ticks if any show
		d3.selectAll(".timelineTick").classed("hidden", true);
	}
	function updateUiSortGender() {
		// Update a/o buttons
		d3.select("#sortKey")
		.style("background-color", buttonColorOff);
		d3.select("#sortHecho")
		.style("background-color", buttonColorOff);
		d3.select("#sortActor")
		.style("background-color", buttonColorOff);
		d3.select("#sortRace")
		.style("background-color", buttonColorOff);
		d3.select("#sortEventDate")
		.style("background-color", buttonColorOff);
		d3.select("#sortReportDate")
		.style("background-color", buttonColorOff);
		//Update this button
		d3.select("#sortGender")
		.style("background-color", buttonColorOn);
		//Hide the timelines if any show
		d3.selectAll(".timeline").classed("hidden", true);
		//Hide the ticks if any show
		d3.selectAll(".timelineTick").classed("hidden", true);
	}
	function updateUiSortRace() {
		// Update a/o buttons
		d3.select("#sortKey")
		.style("background-color", buttonColorOff);
		d3.select("#sortHecho")
		.style("background-color", buttonColorOff);
		d3.select("#sortActor")
		.style("background-color", buttonColorOff);
		d3.select("#sortGender")
		.style("background-color", buttonColorOff);
		d3.select("#sortEventDate")
		.style("background-color", buttonColorOff);
		d3.select("#sortReportDate")
		.style("background-color", buttonColorOff);
		//Update this button
		d3.select("#sortRace")
		.style("background-color", buttonColorOn);
		//Hide the timelines if any show
		d3.selectAll(".timeline").classed("hidden", true);
		//Hide the ticks if any show
		d3.selectAll(".timelineTick").classed("hidden", true);
	}
	function updateUiSortEventDate() {
		// Update a/o buttons
		d3.select("#sortKey")
		.style("background-color", buttonColorOff);
		d3.select("#sortHecho")
		.style("background-color", buttonColorOff);
		d3.select("#sortActor")
		.style("background-color", buttonColorOff);
		d3.select("#sortGender")
		.style("background-color", buttonColorOff);
		d3.select("#sortRace")
		.style("background-color", buttonColorOff);
		d3.select("#sortReportDate")
		.style("background-color", buttonColorOff);
		//Update this button
		d3.select("#sortEventDate")
		.style("background-color", buttonColorOn);
		//Show the event timeline
		d3.selectAll(".timeline#event").classed("hidden", false);
		//Show the timeline event ticks
		d3.selectAll(".timelineTick#event").classed("hidden", false);
		//Hide the other timeline
		d3.selectAll(".timeline#report").classed("hidden", true);
		//Hide the timeline event ticks
		d3.selectAll(".timelineTick#report").classed("hidden", true);
	}
	function updateUiSortReportDate() {
		// Update a/o buttons
		d3.select("#sortKey")
		.style("background-color", buttonColorOff);
		d3.select("#sortHecho")
		.style("background-color", buttonColorOff);
		d3.select("#sortActor")
		.style("background-color", buttonColorOff);
		d3.select("#sortGender")
		.style("background-color", buttonColorOff);
		d3.select("#sortRace")
		.style("background-color", buttonColorOff);
		d3.select("#sortEventDate")
		.style("background-color", buttonColorOff);
		//Update this button
		d3.select("#sortReportDate")
		.style("background-color", buttonColorOn);
		//Show the report timeline
		d3.selectAll(".timeline#report").classed("hidden", false);
		//Show the timeline event ticks
		d3.selectAll(".timelineTick#report").classed("hidden", false);
		//Hide the other timeline
		d3.selectAll(".timeline#event").classed("hidden", true);
		//Hide the timeline event ticks
		d3.selectAll(".timelineTick#event").classed("hidden", true);
	}

	function updateUiColorKey() {
		//Update legend text
		d3.select("#legend01Text")
		.text("");
		d3.select("#legend02Text")
		.text("");
		d3.select("#legend03Text")
		.text("");
		d3.select("#legend04Text")
		.text("Coloring by Key");
		//Update legend rectangels
		d3.select("#legendRect01")
		.style("background-color", "#000000");
		d3.select("#legendRect02")
		.style("background-color", "#000000");
		d3.select("#legendRect03")
		.style("background-color", "#000000");
		d3.select("#legendRect04")
		.style("background-color", "#fff");
		d3.select("#legendRect05")
		.style("background-color", "#000000");
		d3.select("#legendGradient")
		.classed("hidden", true);
		//Update a/o color buttons
		d3.select("#colorHecho")
		.style("background-color", buttonColorOff);
		d3.select("#colorActor")
		.style("background-color", buttonColorOff);
		d3.select("#colorGender")
		.style("background-color", buttonColorOff);
		d3.select("#colorRace")
		.style("background-color", buttonColorOff);
		d3.select("#colorEventDate")
		.style("background-color", buttonColorOff);
		d3.select("#colorReportDate")
		.style("background-color", buttonColorOff);
		//Update this color button
		d3.select("#colorKey")
		.style("background-color", buttonColorOn);
	}
	function updateUiColorHecho() {
		//Update legend text
		d3.select("#legend01Text")
		.text("Displacement");
		d3.select("#legend02Text")
		.text("Homicide");
		d3.select("#legend03Text")
		.text("Threat");
		d3.select("#legend04Text")
		.text("Other");
		d3.select("#legend05Text")
		.text("");
		//Update legend rectangels
		d3.select("#legendRect01")
		.style("background-color", "#FF6600");
		d3.select("#legendRect02")
		.style("background-color", "#00FFD0");
		d3.select("#legendRect03")
		.style("background-color", "#459FFF");
		d3.select("#legendRect04")
		.style("background-color", "#595959");
		d3.select("#legendRect05")
		.style("background-color", "#000000");
		d3.select("#legendGradient")
		.classed("hidden", true);
		//Update a/o color buttons
		d3.select("#colorKey")
		.style("background-color", buttonColorOff);
		d3.select("#colorActor")
		.style("background-color", buttonColorOff);
		d3.select("#colorGender")
		.style("background-color", buttonColorOff);
		d3.select("#colorRace")
		.style("background-color", buttonColorOff);
		d3.select("#colorEventDate")
		.style("background-color", buttonColorOff);
		d3.select("#colorReportDate")
		.style("background-color", buttonColorOff);
		//Update this color button
		d3.select("#colorHecho")
		.style("background-color", buttonColorOn);
	}
	function updateUiColorActor() {
		//Update legend
		d3.select("#legend01Text")
		.text("Guerrillas");
		d3.select("#legend02Text")
		.text("Paramilitaries");
		d3.select("#legend03Text")
		.text("Armed Forces");
		d3.select("#legend05Text")
		.text("Other or Non-Identified");
		d3.select("#legend04Text")
		.text("BACRIM");
		//Update legend rectangels
		d3.select("#legendRect01")
		.style("background-color", "#FF2EC0");
		d3.select("#legendRect02")
		.style("background-color", "#C0FF2E");
		d3.select("#legendRect03")
		.style("background-color", "#2EC0FF");
		d3.select("#legendRect05")
		.style("background-color", "#595959");
		d3.select("#legendRect04")
		.style("background-color", "#FF9E2E");
		d3.select("#legendGradient")
		.classed("hidden", true);
		//Update a/o color buttons
		d3.select("#colorKey")
		.style("background-color", buttonColorOff);
		d3.select("#colorHecho")
		.style("background-color", buttonColorOff);
		d3.select("#colorGender")
		.style("background-color", buttonColorOff);
		d3.select("#colorRace")
		.style("background-color", buttonColorOff);
		d3.select("#colorEventDate")
		.style("background-color", buttonColorOff);
		d3.select("#colorReportDate")
		.style("background-color", buttonColorOff);
		//Update this color button
		d3.select("#colorActor")
		.style("background-color", buttonColorOn);
	}
	function updateUiColorGender() {
		//Update legend text
		d3.select("#legend01Text")
		.text("");
		d3.select("#legend02Text")
		.text("Male");
		d3.select("#legend03Text")
		.text("Female");
		d3.select("#legend04Text")
		.text("Other or N/A");
		d3.select("#legend05Text")
		.text("");
		//Update legend rectangels
		d3.select("#legendRect01")
		.style("background-color", "#000000");
		d3.select("#legendRect02")
		.style("background-color", "#40FF9F");
		d3.select("#legendRect03")
		.style("background-color", "#FFBC40");
		d3.select("#legendRect04")
		.style("background-color", "#BC40FF");
		d3.select("#legendRect05")
		.style("background-color", "#000000");
		d3.select("#legendGradient")
		.classed("hidden", true);
		//Update a/o color buttons
		d3.select("#colorKey")
		.style("background-color", buttonColorOff);
		d3.select("#colorHecho")
		.style("background-color", buttonColorOff);
		d3.select("#colorActor")
		.style("background-color", buttonColorOff);
		d3.select("#colorRace")
		.style("background-color", buttonColorOff);
		d3.select("#colorEventDate")
		.style("background-color", buttonColorOff);
		d3.select("#colorReportDate")
		.style("background-color", buttonColorOff);
		//Update this color button
		d3.select("#colorGender")
		.style("background-color", buttonColorOn);
	}

	function updateUiColorRace() {
		//Update legend text
		d3.select("#legend01Text")
		.text("None");
		d3.select("#legend02Text")
		.text("Afrocolombian");
		d3.select("#legend03Text")
		.text("Indigenous");
		d3.select("#legend04Text")
		.text("Other");
		d3.select("#legend05Text")
		.text("");
		//Update legend rectangels
		d3.select("#legendRect01")
		.style("background-color", "#40FF9F");
		d3.select("#legendRect02")
		.style("background-color", "#FFBC40");
		d3.select("#legendRect03")
		.style("background-color", "#BC40FF");
		d3.select("#legendRect04")
		.style("background-color", "#595959");
		d3.select("#legendRect05")
		.style("background-color", "#000000");
		d3.select("#legendGradient")
		.classed("hidden", true);
		//Update a/o color buttons
		d3.select("#colorKey")
		.style("background-color", buttonColorOff);
		d3.select("#colorHecho")
		.style("background-color", buttonColorOff);
		d3.select("#colorActor")
		.style("background-color", buttonColorOff);
		d3.select("#colorGender")
		.style("background-color", buttonColorOff);
		d3.select("#colorEventDate")
		.style("background-color", buttonColorOff);
		d3.select("#colorReportDate")
		.style("background-color", buttonColorOff);
		//Update this color button
		d3.select("#colorRace")
		.style("background-color", buttonColorOn);
	}
	function updateUiColorEventDate() {
		// //Update legend text
		d3.select("#legend01Text")
		.text("1985");
		d3.select("#legend02Text")
		.text("");
		d3.select("#legend03Text")
		.text("2015");
		d3.select("#legend04Text")
		.text("");
		d3.select("#legend05Text")
		.text("");
		//Update legend rectangels
		d3.select("#legendRect01")
		.style("background-color", "#000000");
		d3.select("#legendRect02")
		.style("background-color", "#000000");
		d3.select("#legendRect03")
		.style("background-color",  "#000000");
		d3.select("#legendRect04")
		.style("background-color", "#000000" );
		d3.select("#legendRect05")
		.style("background-color", "#000000");
		d3.select("#legendGradient")
		.classed("hidden", false)
		//Update a/o color buttons
		d3.select("#colorKey")
		.style("background-color", buttonColorOff);
		d3.select("#colorHecho")
		.style("background-color", buttonColorOff);
		d3.select("#colorActor")
		.style("background-color", buttonColorOff);
		d3.select("#colorGender")
		.style("background-color", buttonColorOff);
		d3.select("#colorRace")
		.style("background-color", buttonColorOff);
		d3.select("#colorReportDate")
		.style("background-color", buttonColorOff);
		//Update this color button
		d3.select("#colorEventDate")
		.style("background-color", buttonColorOn);
	}
	function updateUiColorReportDate() {
		//Update legend text
		d3.select("#legend01Text")
		.text("");
		d3.select("#legend02Text")
		.text("");
		d3.select("#legend03Text")
		.text("1990");
		d3.select("#legend04Text")
		.text("2016");
		d3.select("#legend05Text")
		.text("");
		//Update legend rectangels
		d3.select("#legendRect01")
		.style("background-color", "#000000");
		d3.select("#legendRect02")
		.style("background-color", "#000000");
		d3.select("#legendRect03")
		.style("background-color", "#006465");
		d3.select("#legendRect04")
		.style("background-color", "#ff6360");
		d3.select("#legendRect05")
		.style("background-color", "#000000");
		d3.select("#legendGradient")
		.classed("hidden", true);
		//Update a/o color buttons
		d3.select("#colorKey")
		.style("background-color", buttonColorOff);
		d3.select("#colorHecho")
		.style("background-color", buttonColorOff);
		d3.select("#colorActor")
		.style("background-color", buttonColorOff);
		d3.select("#colorGender")
		.style("background-color", buttonColorOff);
		d3.select("#colorRace")
		.style("background-color", buttonColorOff);
		d3.select("#colorEventDate")
		.style("background-color", buttonColorOff);
		//Update this color button
		d3.select("#colorReportDate")
		.style("background-color", buttonColorOn);
	}
	//On dropdown click, highlight the relevant datapoints
	function dropDownClick(thisId, thisName){
		if(thisName === "all"){
			boolHighlight = false;
			highlightId = '';
			//Update the current municipality text
			document.getElementById('currentMunicip').innerHTML = "<p></p>" ;
		}else{
			boolHighlight = true;
			highlightId = thisId;
			//Update the current municipality text with this name
			document.getElementById('currentMunicip').innerHTML = "<p>"+thisName+"</p>" ;
		}
		//Now that we're highlihgting correctly, update the colors
		updateAllDataColors(currentColor);
	}
	function updateAllDataColors(_currentColorString){
		var _dataSetLen = datasetVictims.length;
		//Update the colors now that we've clicked
		if(_currentColorString === 'key'){
			for (i = 0; i < _dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				geometry.colors[i] = colorKey(thisDataPt);
			}
		}else if(_currentColorString === 'hecho'){
			for (i = 0; i < _dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				geometry.colors[i] = colorHecho(thisDataPt);
			}
		}else if(_currentColorString === 'actor'){
			for (i = 0; i < _dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				geometry.colors[i] = colorActor(thisDataPt);
			}
		}else if(_currentColorString === 'gender'){
			for (i = 0; i < _dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				geometry.colors[i] = colorGender(thisDataPt);
			}
		}else if(_currentColorString === 'race'){
			for (i = 0; i < _dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				geometry.colors[i] = colorRace(thisDataPt);
			}
		}else if(_currentColorString === 'eventDate'){
			for (i = 0; i < _dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				geometry.colors[i] = colorEventDate(thisDataPt);
			}
		}else if(_currentColorString=== 'reportDate'){
			for (i = 0; i < _dataSetLen; i ++){
				var thisDataPt = datasetVictims[i];
				geometry.colors[i] = colorReportDate(thisDataPt);
			}
		}
	}

	//Given a data index return the x and y coordinates in the array
	function getXYCoordinates(_thisIndex, _width, _height) {
		//Sorting from top to bottom, starting at upper left hand corner
		maxHeight = _height - (_height%(rectSize+rectSpacerH)) - dataPadding;
		var myList = [];
		myList[0] = parseInt( ( (1+_thisIndex) * (rectSize+rectSpacerH) ) / maxHeight ) * (rectSpacerW+rectSize)
		myList[1] = parseInt(maxHeight - (_thisIndex*(rectSize+rectSpacerH))%maxHeight)
		return myList;
	}
	//Map values
	function map_range(value, low1, high1, low2, high2) {
		return low2 + (high2 - low2) * (value - low1) / (high1 - low1);
	}
	</script>
	<!-- ****** Scripts ****** -->
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="../js/bootstrap.min.js"></script>
	<script type="text/javascript">
	$(document).ready(function(){
		$("#myModal").modal('show');
	});
	</script>
</body>
</html>
